(()=>{var e={};e.id=405,e.ids=[405,888,660],e.modules={6030:(e,t,r)=>{"use strict";r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{config:()=>p,default:()=>x,getServerSideProps:()=>h,getStaticPaths:()=>g,getStaticProps:()=>m,reportWebVitals:()=>b,routeModule:()=>N,unstable_getServerProps:()=>v,unstable_getServerSideProps:()=>w,unstable_getStaticParams:()=>j,unstable_getStaticPaths:()=>f,unstable_getStaticProps:()=>y});var a=r(7093),l=r(5244),o=r(1323),n=r(9209),i=r.n(n),d=r(9597),c=r(7052),u=e([c]);c=(u.then?(await u)():u)[0];let x=(0,o.l)(c,"default"),m=(0,o.l)(c,"getStaticProps"),g=(0,o.l)(c,"getStaticPaths"),h=(0,o.l)(c,"getServerSideProps"),p=(0,o.l)(c,"config"),b=(0,o.l)(c,"reportWebVitals"),y=(0,o.l)(c,"unstable_getStaticProps"),f=(0,o.l)(c,"unstable_getStaticPaths"),j=(0,o.l)(c,"unstable_getStaticParams"),v=(0,o.l)(c,"unstable_getServerProps"),w=(0,o.l)(c,"unstable_getServerSideProps"),N=new a.PagesRouteModule({definition:{kind:l.x.PAGES,page:"/index",pathname:"/",bundlePath:"",filename:""},components:{App:d.default,Document:i()},userland:c});s()}catch(e){s(e)}})},9597:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>App});var s=r(997);function App({Component:e,pageProps:t}){return s.jsx(e,{...t})}r(6764)},7052:(e,t,r)=>{"use strict";r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{default:()=>Dashboard});var a=r(997),l=r(6689),o=r(1163),n=r(9648),i=r(6201),d=r(3219),c=r(3766),u=r(8532),x=r(250),m=r(8051),g=r(1581),h=r(3217),p=r(1012),b=r(3742),y=r(3718),f=r(7861),j=r(2841),v=r(5097),w=e([n,i]);[n,i]=w.then?(await w)():w;let N=process.env.NEXT_PUBLIC_API_URL?process.env.NEXT_PUBLIC_API_URL:"http://localhost:8080";function Dashboard(){let[e,t]=(0,l.useState)(""),[r,s]=(0,l.useState)(""),[w,S]=(0,l.useState)(!1),[$,k]=(0,l.useState)(!1),[_,A]=(0,l.useState)(""),[P,D]=(0,l.useState)([]),[E,z]=(0,l.useState)(new Set),[q,C]=(0,l.useState)(!1),[Z,R]=(0,l.useState)(null),[L,U]=(0,l.useState)(null),[I,B]=(0,l.useState)(!1),[T,F]=(0,l.useState)(!1),[K,M]=(0,l.useState)(!1),[Q,V]=(0,l.useState)(""),W=(0,o.useRouter)();(0,l.useEffect)(()=>{let e=localStorage.getItem("token");if(e){A(e);let t="true"===localStorage.getItem("darkMode");B(t);let{agentId:r}=W.query;r?(U(r),loadAgentData(r,e)):W.push("/agents")}else W.push("/login");let handleKeyDown=e=>{(e.ctrlKey||e.metaKey)&&"k"===e.key&&(e.preventDefault(),document.querySelector('input[placeholder="Posez votre question..."]')?.focus()),"Escape"===e.key&&(t(""),document.querySelector('input[placeholder="Posez votre question..."]')?.blur())};return window.addEventListener("keydown",handleKeyDown),()=>window.removeEventListener("keydown",handleKeyDown)},[W,W.query]);let loadAgentData=async(e,t)=>{C(!0);try{let r=await n.default.get(`${N}/agents`,{headers:{Authorization:`Bearer ${t}`}}),s=r.data.agents?.find(t=>t.id.toString()===e.toString());if(!s){i.default.error("Companion IA non trouv\xe9"),W.push("/agents");return}R(s);let a=await n.default.get(`${N}/user/documents?agent_id=${e}`,{headers:{Authorization:`Bearer ${t}`}});D(a.data.documents||[]),z(new Set((a.data.documents||[]).map(e=>e.id)))}catch(e){console.error("Error loading agent data:",e),i.default.error("Erreur lors du chargement de l'agent")}finally{C(!1)}},loadDocuments=async e=>{C(!0);try{let t=await n.default.get(`${N}/user/documents`,{headers:{Authorization:`Bearer ${e}`}});D(t.data.documents),z(new Set(t.data.documents.map(e=>e.id)))}catch(e){console.error("Error loading documents:",e),i.default.error("Erreur lors du chargement des documents")}finally{C(!1)}},showSuccessToast=e=>{i.default.success(e,{duration:3e3,style:{background:I?"#374151":"#fff",color:I?"#fff":"#000"}})},showErrorToast=e=>{i.default.error(e,{duration:4e3,style:{background:I?"#374151":"#fff",color:I?"#fff":"#000"}})},askQuestion=async()=>{if(!e.trim()){showErrorToast("Veuillez poser une question");return}S(!0);try{let t=await n.default.post(`${N}/ask`,{question:e,selected_documents:Array.from(E),agent_id:Z?.id||L},{headers:{Authorization:`Bearer ${_}`,"Content-Type":"application/json"}});s(t.data.answer),showSuccessToast("R\xe9ponse g\xe9n\xe9r\xe9e avec succ\xe8s !")}catch(e){console.error("Error:",e),showErrorToast("Erreur lors de la g\xe9n\xe9ration de la r\xe9ponse")}finally{S(!1)}},handleFileUpload=async e=>{let t=e.target.files[0];if(t){k(!0);try{if(Z){let e=new FormData;e.append("file",t),e.append("agent_id",Z.id.toString()),await n.default.post(`${N}/upload-agent`,e,{headers:{Authorization:`Bearer ${_}`}}),loadAgentData(Z.id,_)}else{let e=new FormData;e.append("file",t),await n.default.post(`${N}/upload`,e,{headers:{Authorization:`Bearer ${_}`}}),loadDocuments(_)}i.default.success(`Document "${t.name}" ajout\xe9 avec succ\xe8s !`),e.target.value=""}catch(e){console.error("Upload error:",e),i.default.error("Erreur lors de l'ajout du document")}finally{k(!1)}}},deleteDocument=async e=>{try{await n.default.delete(`${N}/documents/${e}`,{headers:{Authorization:`Bearer ${_}`}}),D(t=>t.filter(t=>t.id!==e)),z(t=>{let r=new Set(t);return r.delete(e),r}),i.default.success("Document supprim\xe9")}catch(e){console.error("Error deleting document:",e),i.default.error("Erreur lors de la suppression")}},toggleDocumentSelection=e=>{z(t=>{let r=new Set(t);return r.has(e)?r.delete(e):r.add(e),r})};return(0,a.jsxs)("div",{className:`min-h-screen flex transition-colors duration-300 ${I?"bg-gray-900":"bg-gray-50"}`,children:[a.jsx(i.Toaster,{position:"top-right",toastOptions:{style:{background:I?"#374151":"#fff",color:I?"#fff":"#000"}}}),(0,a.jsxs)("div",{className:`w-80 shadow-lg border-r flex flex-col transition-colors duration-300 ${I?"bg-gray-800 border-gray-700":"bg-white border-gray-200"}`,children:[Z&&a.jsx("div",{className:"p-4 border-b border-blue-100 bg-blue-50 flex items-center justify-start",children:a.jsx("button",{onClick:()=>W.push(`/chat/${Z.id}`),className:"text-white bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg font-semibold shadow",style:{minWidth:90},children:"Users"})}),(0,a.jsxs)("div",{className:`p-6 border-b transition-colors duration-300 ${I?"border-gray-700":"border-gray-200"}`,children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[a.jsx("button",{onClick:()=>W.push("/agents"),className:`mr-3 p-1 transition-colors ${I?"text-gray-400 hover:text-blue-400":"text-gray-500 hover:text-blue-600"}`,title:"Retour aux agents",children:a.jsx(d.Z,{className:"w-5 h-5"})}),(0,a.jsxs)("h2",{className:`text-xl font-bold flex items-center ${I?"text-gray-100":"text-gray-800"}`,children:[a.jsx(c.Z,{className:"w-6 h-6 mr-2 text-blue-600"}),"Sources"]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[a.jsx("button",{onClick:()=>{let e=!I;B(e),localStorage.setItem("darkMode",e.toString())},className:`p-2 rounded-lg transition-colors ${I?"text-yellow-400 hover:bg-gray-700":"text-gray-600 hover:bg-gray-100"}`,title:I?"Mode clair":"Mode sombre",children:I?a.jsx(u.Z,{className:"w-5 h-5"}):a.jsx(x.Z,{className:"w-5 h-5"})}),a.jsx("button",{onClick:()=>{localStorage.removeItem("token"),W.push("/login")},className:`p-2 rounded-lg transition-colors ${I?"text-gray-400 hover:text-red-400 hover:bg-gray-700":"text-gray-500 hover:text-red-600 hover:bg-gray-100"}`,title:"Se d\xe9connecter",children:a.jsx(m.Z,{className:"w-5 h-5"})})]})]}),Z&&a.jsx("div",{className:`mb-4 p-3 rounded-lg transition-colors duration-300 ${I?"bg-gray-700":"bg-gray-50"}`,children:(0,a.jsxs)("div",{className:"flex items-center",children:[a.jsx(g.Z,{className:`w-5 h-5 mr-2 ${"sales"===Z.type?"text-green-600":"marketing"===Z.type?"text-purple-600":"hr"===Z.type?"text-blue-600":"text-orange-600"}`}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:`font-medium ${I?"text-gray-100":"text-gray-800"}`,children:[Z.name," (",Z.type,")"]}),a.jsx("p",{className:`text-sm capitalize ${I?"text-gray-300":"text-gray-600"}`,children:Z.type})]})]})}),(0,a.jsxs)("label",{className:`flex items-center justify-center w-full p-3 border-2 border-dashed rounded-lg cursor-pointer transition-colors duration-300 ${I?"border-blue-400 hover:border-blue-300 hover:bg-gray-700":"border-blue-300 hover:border-blue-400 hover:bg-blue-50"}`,children:[a.jsx("input",{type:"file",className:"hidden",accept:".pdf,.txt,.docx",onChange:handleFileUpload,disabled:$}),$?a.jsx(h.Z,{className:"w-5 h-5 mr-2 text-blue-600 animate-spin"}):a.jsx(p.Z,{className:"w-5 h-5 mr-2 text-blue-600"}),a.jsx("span",{className:"text-blue-600 font-medium",children:$?"Ajout en cours...":"Ajouter"})]}),(0,a.jsxs)("div",{className:"flex items-center mt-4 space-x-2",children:[a.jsx("input",{type:"text",className:`flex-1 px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all ${I?"border-gray-600 bg-gray-700 text-gray-100 placeholder-gray-400":"border-gray-300 bg-white text-gray-900 placeholder-gray-500"}`,placeholder:"Ajouter une URL (https://...)",value:Q,onChange:e=>V(e.target.value),disabled:$}),a.jsx("button",{type:"button",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 transition-colors font-medium",disabled:$||!Q.trim(),onClick:async()=>{if(Q.trim()){k(!0);try{let e={url:Q};Z&&(e.agent_id=Z.id),await n.default.post(`${N}/upload-url`,e,{headers:{Authorization:`Bearer ${_}`}}),i.default.success("URL ajout\xe9e avec succ\xe8s !"),V(""),Z?loadAgentData(Z.id,_):loadDocuments(_)}catch(e){console.error("Erreur lors de l'ajout de l'URL:",e),i.default.error("Erreur lors de l'ajout de l'URL")}finally{k(!1)}}},children:"Ajouter l'URL"})]})]}),a.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:q?(0,a.jsxs)("div",{className:`text-center py-8 ${I?"text-gray-400":"text-gray-500"}`,children:[a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"}),"Chargement des documents..."]}):0===P.length?(0,a.jsxs)("div",{className:`text-center py-8 ${I?"text-gray-400":"text-gray-500"}`,children:[a.jsx(c.Z,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),a.jsx("p",{className:"font-medium",children:"Aucun document"}),a.jsx("p",{className:"text-sm",children:"Ajoutez des documents pour commencer"})]}):a.jsx("div",{className:"space-y-2",children:P.map(e=>a.jsx("div",{className:`p-3 rounded-lg border transition-all duration-200 ${E.has(e.id)?"border-blue-500 bg-blue-50 dark:bg-blue-900/20 dark:border-blue-400":I?"border-gray-600 bg-gray-700 hover:bg-gray-600":"border-gray-200 bg-gray-50 hover:bg-gray-100"}`,children:(0,a.jsxs)("div",{className:"flex items-start space-x-3",children:[a.jsx("button",{onClick:()=>toggleDocumentSelection(e.id),className:`flex-shrink-0 w-5 h-5 rounded border-2 flex items-center justify-center transition-colors ${E.has(e.id)?"bg-blue-600 border-blue-600":I?"border-gray-500 hover:border-blue-400":"border-gray-300 hover:border-blue-400"}`,children:E.has(e.id)&&a.jsx(b.Z,{className:"w-3 h-3 text-white"})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[a.jsx(c.Z,{className:`w-4 h-4 flex-shrink-0 ${I?"text-gray-400":"text-gray-500"}`}),a.jsx("p",{className:`text-sm font-medium truncate ${I?"text-gray-200":"text-gray-900"}`,title:e.filename,children:e.filename})]}),a.jsx("p",{className:`text-xs mt-1 ${I?"text-gray-400":"text-gray-500"}`,children:new Date(e.created_at).toLocaleDateString("fr-FR")})]}),a.jsx("button",{onClick:()=>deleteDocument(e.id),className:`flex-shrink-0 p-1 transition-colors ${I?"text-gray-500 hover:text-red-400":"text-gray-400 hover:text-red-600"}`,title:"Supprimer",children:a.jsx(y.Z,{className:"w-4 h-4"})})]})},e.id))})})]}),(0,a.jsxs)("div",{className:"flex-1 flex flex-col",children:[a.jsx("div",{className:`border-b p-4 transition-colors ${I?"border-gray-600 bg-gray-800":"border-gray-200 bg-white"}`,children:Z&&(0,a.jsxs)("div",{className:"flex items-center",children:[a.jsx(g.Z,{className:`w-6 h-6 mr-3 ${"sales"===Z.type?"text-green-600":"marketing"===Z.type?"text-purple-600":"hr"===Z.type?"text-blue-600":"text-orange-600"}`}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("h1",{className:`text-xl font-bold ${I?"text-gray-100":"text-gray-800"}`,children:[Z.name," (",Z.type,")"]}),(0,a.jsxs)("p",{className:`text-sm capitalize ${I?"text-gray-300":"text-gray-600"}`,children:["Companion IA ",Z.type]})]})]})}),a.jsx("div",{className:`border-b p-6 transition-colors ${I?"border-gray-600 bg-gray-800":"border-gray-200 bg-white"}`,children:(0,a.jsxs)("div",{className:"flex space-x-4",children:[(0,a.jsxs)("div",{className:"relative flex-1",children:[a.jsx("input",{type:"text",value:e,onChange:e=>{t(e.target.value),F(!0),setTimeout(()=>F(!1),1e3)},onKeyPress:e=>"Enter"===e.key&&askQuestion(),placeholder:"Posez votre question...",className:`w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all ${I?"border-gray-600 bg-gray-700 text-gray-100 placeholder-gray-400":"border-gray-300 bg-white text-gray-900 placeholder-gray-500"}`,disabled:w}),T&&a.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:(0,a.jsxs)("div",{className:"flex space-x-1",children:[a.jsx("div",{className:"w-2 h-2 bg-blue-600 rounded-full animate-bounce"}),a.jsx("div",{className:"w-2 h-2 bg-blue-600 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),a.jsx("div",{className:"w-2 h-2 bg-blue-600 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})})]}),a.jsx("button",{type:"button",onClick:()=>{if(!("webkitSpeechRecognition"in window)){i.default.error("La reconnaissance vocale n'est pas support\xe9e sur ce navigateur.");return}let e=new window.webkitSpeechRecognition;e.lang="fr-FR",e.interimResults=!1,e.maxAlternatives=1,M(!0),e.onresult=e=>{let r=e.results[0][0].transcript;t(e=>e?e+" "+r:r),F(!0)},e.onerror=()=>M(!1),e.onend=()=>M(!1),e.start()},className:`p-3 rounded-lg bg-blue-100 hover:bg-blue-200 ${K?"animate-pulse":""}`,title:"Entr\xe9e vocale",disabled:K,children:a.jsx(f.Z,{className:"w-5 h-5 text-blue-600"})}),(0,a.jsxs)("button",{onClick:askQuestion,disabled:w||!e.trim(),className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center space-x-2 font-medium",children:[w?a.jsx(h.Z,{className:"w-4 h-4 animate-spin"}):a.jsx(j.Z,{className:"w-4 h-4"}),a.jsx("span",{children:w?"Envoi...":"Envoyer"})]})]})}),a.jsx("div",{className:`flex-1 p-6 transition-colors ${I?"bg-gray-800":"bg-gray-50"}`,children:w?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-32",children:[a.jsx(h.Z,{className:"w-8 h-8 text-blue-600 animate-spin mb-3"}),a.jsx("p",{className:`text-sm ${I?"text-gray-300":"text-gray-600"}`,children:"Analyse en cours..."})]}):r?a.jsx("div",{className:`rounded-lg p-6 shadow-sm transition-colors ${I?"bg-gray-700":"bg-white"}`,children:a.jsx("div",{className:"prose max-w-none",children:a.jsx("pre",{className:`leading-relaxed whitespace-pre-wrap font-sans text-sm overflow-x-auto ${I?"text-gray-200":"text-gray-800"}`,children:r})})}):(0,a.jsxs)("div",{className:`text-center py-12 ${I?"text-gray-400":"text-gray-500"}`,children:[a.jsx(v.Z,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),a.jsx("h3",{className:`text-xl font-semibold mb-2 ${I?"text-gray-200":"text-gray-700"}`,children:"Bienvenue dans TAIC Companion"}),a.jsx("p",{className:"mb-4",children:0===P.length?"Ajoutez des documents et posez vos questions":"Posez une question bas\xe9e sur vos documents s\xe9lectionn\xe9s"}),P.length>0&&E.size>0&&(0,a.jsxs)("p",{className:"text-sm text-blue-600",children:[E.size," document",E.size>1?"s":""," pr\xeat",E.size>1?"s":""," pour r\xe9pondre \xe0 vos questions"]})]})})]})]})}s()}catch(e){s(e)}})},6764:()=>{},2785:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},6689:e=>{"use strict";e.exports=require("react")},6405:e=>{"use strict";e.exports=require("react-dom")},997:e=>{"use strict";e.exports=require("react/jsx-runtime")},9648:e=>{"use strict";e.exports=import("axios")},6201:e=>{"use strict";e.exports=import("react-hot-toast")},7147:e=>{"use strict";e.exports=require("fs")},1017:e=>{"use strict";e.exports=require("path")},2781:e=>{"use strict";e.exports=require("stream")},7310:e=>{"use strict";e.exports=require("url")},9796:e=>{"use strict";e.exports=require("zlib")}};var t=require("../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),r=t.X(0,[209,450,792,163,297,402],()=>__webpack_exec__(6030));module.exports=r})();