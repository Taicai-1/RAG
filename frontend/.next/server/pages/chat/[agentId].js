(()=>{var e={};e.id=574,e.ids=[574,888,660],e.modules={5071:(e,t,r)=>{"use strict";r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{config:()=>m,default:()=>g,getServerSideProps:()=>x,getStaticPaths:()=>p,getStaticProps:()=>h,reportWebVitals:()=>b,routeModule:()=>j,unstable_getServerProps:()=>v,unstable_getServerSideProps:()=>_,unstable_getStaticParams:()=>w,unstable_getStaticPaths:()=>y,unstable_getStaticProps:()=>f});var a=r(7093),l=r(5244),n=r(1323),o=r(9209),i=r.n(o),c=r(9597),d=r(3919),u=e([d]);d=(u.then?(await u)():u)[0];let g=(0,n.l)(d,"default"),h=(0,n.l)(d,"getStaticProps"),p=(0,n.l)(d,"getStaticPaths"),x=(0,n.l)(d,"getServerSideProps"),m=(0,n.l)(d,"config"),b=(0,n.l)(d,"reportWebVitals"),f=(0,n.l)(d,"unstable_getStaticProps"),y=(0,n.l)(d,"unstable_getStaticPaths"),w=(0,n.l)(d,"unstable_getStaticParams"),v=(0,n.l)(d,"unstable_getServerProps"),_=(0,n.l)(d,"unstable_getServerSideProps"),j=new a.PagesRouteModule({definition:{kind:l.x.PAGES,page:"/chat/[agentId]",pathname:"/chat/[agentId]",bundlePath:"",filename:""},components:{App:c.default,Document:i()},userland:d});s()}catch(e){s(e)}})},9597:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>App});var s=r(997);function App({Component:e,pageProps:t}){return s.jsx(e,{...t})}r(6764)},3919:(e,t,r)=>{"use strict";r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{default:()=>AgentChatPage});var a=r(997),l=r(6689),n=r(1163),o=r(9648),i=r(5675),c=r.n(i),d=r(1664),u=r.n(d),g=e([o]);o=(g.then?(await g)():g)[0];let h=process.env.NEXT_PUBLIC_API_URL?process.env.NEXT_PUBLIC_API_URL:"http://localhost:8080";function AgentChatPage(){let e=(0,n.useRouter)(),{agentId:t}=e.query,[r,s]=(0,l.useState)(null),[i,d]=(0,l.useState)([]),[g,p]=(0,l.useState)(""),[x,m]=(0,l.useState)(!1),[b,f]=(0,l.useState)(""),y=(0,l.useRef)(null);(0,l.useEffect)(()=>{let r=localStorage.getItem("token");if(r||e.push("/login"),f(r),t){loadAgent(t,r);let e=localStorage.getItem(`chat_history_${t}`);if(e)try{d(JSON.parse(e))}catch{d([])}else d([])}},[t]);let loadAgent=async(t,r)=>{try{let a=await o.default.get(`${h}/agents`,{headers:{Authorization:`Bearer ${r}`}}),l=a.data.agents?.find(e=>e.id.toString()===t.toString());l||e.push("/agents"),s(l)}catch(t){e.push("/agents")}},sendMessage=async()=>{if(!g.trim())return;let e=[...i,{role:"user",content:g}];d(e),p(""),m(!0),t&&localStorage.setItem(`chat_history_${t}`,JSON.stringify(e));try{let r=await o.default.post(`${h}/ask`,{question:g,agent_id:t,history:e.filter(e=>"system"!==e.role)},{headers:{Authorization:`Bearer ${b}`,"Content-Type":"application/json"}}),s=[...e,{role:"agent",content:r.data.answer}];d(s),t&&localStorage.setItem(`chat_history_${t}`,JSON.stringify(s))}catch(s){let r=[...e,{role:"agent",content:"Erreur lors de la r\xe9ponse de l'agent."}];d(r),t&&localStorage.setItem(`chat_history_${t}`,JSON.stringify(r))}finally{m(!1),setTimeout(()=>y.current?.scrollIntoView({behavior:"smooth"}),100)}};return((0,l.useEffect)(()=>{setTimeout(()=>y.current?.scrollIntoView({behavior:"smooth"}),100)},[i]),r)?(0,a.jsxs)("div",{className:"min-h-screen flex flex-row bg-gradient-to-br from-blue-50 to-orange-50",children:[(0,a.jsxs)("div",{className:"w-full md:w-1/2 flex flex-col items-center justify-center p-10 bg-gradient-to-br from-blue-100 to-orange-100 border-r border-blue-200",children:[r.profile_photo&&a.jsx("div",{className:"w-64 h-64 rounded-xl overflow-hidden border-4 border-blue-300 shadow-lg mb-8",children:a.jsx(c(),{src:r.profile_photo.startsWith("http")?r.profile_photo:`/uploads/${r.profile_photo.replace(/^.*[\\/]/,"")}`,alt:r.name,width:320,height:320,objectFit:"cover",onError:e=>{e.target.onerror=null,e.target.src="/default-avatar.png"}})}),a.jsx("h1",{className:"text-4xl font-bold text-gray-800 mb-2 text-center uppercase tracking-wide",children:r.name}),a.jsx("h2",{className:"text-lg text-blue-700 font-semibold mb-4 text-center",children:r.titre||""}),a.jsx("div",{className:"bg-white bg-opacity-80 rounded-lg p-6 shadow max-w-xl text-center",children:a.jsx("p",{className:"text-gray-700 text-lg whitespace-pre-line",children:r.biographie})})]}),(0,a.jsxs)("div",{className:"flex-1 flex flex-col h-screen",children:[(0,a.jsxs)("div",{className:"md:hidden flex items-center p-4 bg-white shadow-sm border-b",children:[a.jsx(u(),{href:"/agents",children:a.jsx("button",{className:"text-white bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg font-semibold mr-4",children:"Retour"})}),a.jsx("h2",{className:"text-xl font-bold text-gray-900",children:r.name})]}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto px-4 py-8 flex flex-col space-y-4 bg-gradient-to-br from-white to-orange-50",children:[i.map((e,t)=>a.jsx("div",{className:`flex ${"user"===e.role?"justify-end":"justify-start"}`,children:a.jsx("div",{className:`rounded-2xl px-4 py-3 shadow-sm max-w-[70%] whitespace-pre-line ${"user"===e.role?"bg-blue-600 text-white rounded-br-none":"bg-white text-gray-900 rounded-bl-none border"}`,children:e.content})},t)),x&&a.jsx("div",{className:"flex justify-start",children:(0,a.jsxs)("div",{className:"rounded-2xl px-4 py-3 shadow-sm max-w-[70%] bg-white text-gray-900 rounded-bl-none border flex items-center",children:[a.jsx("span",{className:"inline-block w-2 h-2 bg-gray-400 rounded-full animate-bounce mr-1",style:{animationDelay:"0ms"}}),a.jsx("span",{className:"inline-block w-2 h-2 bg-gray-400 rounded-full animate-bounce mr-1",style:{animationDelay:"150ms"}}),a.jsx("span",{className:"inline-block w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})}),a.jsx("div",{ref:y})]}),(0,a.jsxs)("div",{className:"bg-white border-t p-4 flex items-center",children:[a.jsx("input",{type:"text",className:"flex-1 px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent mr-3",placeholder:"\xc9crivez un message...",value:g,onChange:e=>p(e.target.value),onKeyDown:e=>"Enter"===e.key&&sendMessage(),disabled:x}),a.jsx("button",{onClick:sendMessage,className:"bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-blue-700 transition-colors disabled:opacity-50",disabled:x||!g.trim(),children:"Envoyer"})]})]})]}):a.jsx("div",{className:"min-h-screen flex items-center justify-center",children:"Chargement..."})}s()}catch(e){s(e)}})},6764:()=>{},2785:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},6689:e=>{"use strict";e.exports=require("react")},6405:e=>{"use strict";e.exports=require("react-dom")},997:e=>{"use strict";e.exports=require("react/jsx-runtime")},9648:e=>{"use strict";e.exports=import("axios")},7147:e=>{"use strict";e.exports=require("fs")},1017:e=>{"use strict";e.exports=require("path")},2781:e=>{"use strict";e.exports=require("stream")},7310:e=>{"use strict";e.exports=require("url")},9796:e=>{"use strict";e.exports=require("zlib")}};var t=require("../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),r=t.X(0,[209,450,792,163,201,61],()=>__webpack_exec__(5071));module.exports=r})();